### 概述

这是关于现金贷自动化测试方案描述，包括应用容器化、环境搭建、镜像仓库、自动化、性能压测、持续集成以及后期维护。

> **根据经历过的敏捷开发流程（每周2个版本迭代速度）的大概流程、250个左右的虚拟机环境以及上万条测试用例、测试质量维护，有些情况可能不适合**

[TOC]

### 应用容器化

- 环境分析
- 配置分离
- 容器化

对于环境分析，需要分析目前环境对接的第三方配置以及拓扑图，能否实现各个部件的内网搭建，以及处理无法内网部署的服务。

对于配置分离，是将配置项与代码剥离，实现解耦，方便容器的部署以及可能的微服务（后期的服务解耦）。

对于容器化，主要是编写`Dockerfile`实现应用构建步骤以及设置配置项，方便后期的容器集成。或者通过容器来快速安装，进行功能验证。

> **对于不能实现容器，也可以在通过`Dockerfile`来进行代码构建以及`ansible`插件部署**
>
> **测试环境安装的容器化，实现持续集成与测试**

###环境搭建

* 服务器
* 安装编排

对于服务器，需要规划好资源（不确定是公网还是内网服务器，需要申请购买），进行后续的安装编排，实现自动构建部署，实现敏捷。

对于环境安装，需要编写安装脚本实现检查环境变量，应用版本显示版本标识。

> **对于版本标识需要控制**

###镜像仓库

存储应用镜像，以及镜像版本控制，在安装编排中进行制定版本安装。

###自动化

* 接口自动化工具
* 接口分析
* 自动化范围
* 代码覆盖率
* 测试桩

对于接口自动化工具，目前考虑`httprunner`以及`robotframework`，推荐使用`httprunner`，当考虑到开发未提供接口文档或者接口文档不清晰，可以通过抓包，来生成接口接口自动化用例。

对于接口分析，需要理清接口逻辑以及数据库入库，基于用户数据层面，实现端到端的自动化测试。

对于自动化范围，`app`端自动化以及接口自动化。

通过代码覆盖率来确定是否增加自动化用例，`java`加载`jacoco`来实现。

采用测试桩来实现环境中无法安装的服务，需要评估环境需要安装哪些测试桩。

采用容器化，个人拥有同一套环境，减少环境因素干扰，以及自动化环境，方便自动化用例的调试。

> **需要考虑的是`KTP`的人脸识别以及`OCR`图像识别的实现方式；`app`需要使用`mac`电脑，实现`ios`端自动化**
>
> **`httprunner`工具目前还是处于完善阶段，可能会有坑，需要实践以及查看源码**

### 性能压测

如果采用`httprunner`工具，可以通过其内置的压力测试工具`Locust `来实现，复用自动化用例。

> **需要确认后期的用户量以及性能指标，性能环境搭建，提前发现性能瓶颈**

### 持续集成

目前有两个工具，`jenkins`以及`drone`来实现构建以及安装部署，自动化测试流水线。同时基于`drone`插件实现`kubernetes`编排，后期可以将应用迁移到`kubernets`中。

### 后期维护

需要与开发确认接口变更流程以及文档编写，以及自动化测试用例编写规划。

> **对于文档编写，推荐采用`confluence`团队协作的wiki编写工具，后期可以考虑产品需求文档迁移到`confluence`中，需要申请机器搭建。**

### 需求模块开发人员列表

版本需求开发人员名单，有开发经理提供列表，方便及时与开发人员沟通`bug`。

### 业务时序

提供业务流程图，手工画或者工具画。

### 交付测试

交付内容有升级方案、版本包、数据库`sql`、升级说明。将构建生成的版本包和`sql`放置到`gitlab`的`release`页面，提供说明。

`sql`提交到代码仓库进行版本控制，方便版本迭代数据库的验证，同时在构建环境编写脚本来升级数据库。

以上可以通过一些插件来实现自动化。

> **具体来说，当修改了某一项后，可以通过再次构建来验证功能正确，环境可移植以及接口功能自动化，升级方案进行评估升级影响范围和细节。**

### 安全测试

通过代码的静态扫描，加入持续集成步骤中，实现自动扫描。

服务器端通过`linux`安全扫描工具。

通过`sqlmap`数据库扫描，需要编写注入扫描脚本。

`ssl`安全扫描，在线扫描网站[ssllabs](https://www.ssllabs.com/)。

> **主要是检查一些常见漏洞，以及一些编码错误；服务器通过已知漏洞库**
>
> **经验问题效果不会有很大，作用是预防**

### Drone插件

通过其插件来实现以上所有的构建步骤以及通知、邮件、Rocket.chat消息通知。

> **Rocket.chat自带hubot运维机器人，需要根据需求编写`js`脚本，同时有`android`和`IOS`客户端，需要确定服务器端部署方案和容灾备份机制**

### Gitea服务器

git代码库服务器，可以与`Drone`进行集成。

### 微信Robot

todo

> **运维机器人，通过`webhook`实现**

###控制台爬虫

编写爬虫脚本，检查网站的超链接是否正常。

### 监控方案

todo

> **Prometheus实现测试和线上环境监控**

### 弹性伸缩

todo

### 容灾方案

todo

